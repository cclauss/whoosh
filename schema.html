<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing a schema &mdash; Whoosh-Reloaded 2.7.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to index documents" href="indexing.html" />
    <link rel="prev" title="Glossary" href="glossary.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Whoosh-Reloaded
          </a>
              <div class="version">
                2.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to Whoosh</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Designing a schema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#about-schemas-and-fields">About schemas and fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="#built-in-field-types">Built-in field types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-schema">Creating a Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-the-schema-after-indexing">Modifying the schema after indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-fields">Dynamic fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-schema-setup">Advanced schema setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#field-boosts">Field boosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-types">Field types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#formats">Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vectors">Vectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">How to index documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="searching.html">How to search</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsing.html">Parsing user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="querylang.html">The default query language</a></li>
<li class="toctree-l1"><a class="reference internal" href="dates.html">Indexing and parsing dates/times</a></li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Query objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">About analyzers</a></li>
<li class="toctree-l1"><a class="reference internal" href="stemming.html">Stemming, variations, and accent folding</a></li>
<li class="toctree-l1"><a class="reference internal" href="ngrams.html">Indexing and searching N-grams</a></li>
<li class="toctree-l1"><a class="reference internal" href="facets.html">Sorting and faceting</a></li>
<li class="toctree-l1"><a class="reference internal" href="highlight.html">How to create highlighted search result excerpts</a></li>
<li class="toctree-l1"><a class="reference internal" href="keywords.html">Query expansion and Key word extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="spelling.html">“Did you mean… ?” Correcting errors in user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="fieldcaches.html">Field caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Tips for speeding up batch indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="threads.html">Concurrency, locking, and versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested.html">Indexing and searching document hierarchies</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Whoosh recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">Whoosh API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech/index.html">Technical notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Whoosh-Reloaded</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Designing a schema</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/schema.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="designing-a-schema">
<h1>Designing a schema<a class="headerlink" href="#designing-a-schema" title="Permalink to this heading">¶</a></h1>
<section id="about-schemas-and-fields">
<h2>About schemas and fields<a class="headerlink" href="#about-schemas-and-fields" title="Permalink to this heading">¶</a></h2>
<p>The schema specifies the fields of documents in an index.</p>
<p>Each document can have multiple fields, such as title, content, url, date, etc.</p>
<p>Some fields can be indexed, and some fields can be stored with the document so
the field value is available in search results.
Some fields will be both indexed and stored.</p>
<p>The schema is the set of all possible fields in a document. Each individual
document might only use a subset of the available fields in the schema.</p>
<p>For example, a simple schema for indexing emails might have fields like
<code class="docutils literal notranslate"><span class="pre">from_addr</span></code>, <code class="docutils literal notranslate"><span class="pre">to_addr</span></code>, <code class="docutils literal notranslate"><span class="pre">subject</span></code>, <code class="docutils literal notranslate"><span class="pre">body</span></code>, and <code class="docutils literal notranslate"><span class="pre">attachments</span></code>, where
the <code class="docutils literal notranslate"><span class="pre">attachments</span></code> field lists the names of attachments to the email. For
emails without attachments, you would omit the attachments field.</p>
</section>
<section id="built-in-field-types">
<h2>Built-in field types<a class="headerlink" href="#built-in-field-types" title="Permalink to this heading">¶</a></h2>
<p>Whoosh provides some useful predefined field types:</p>
<dl>
<dt>:class:` whoosh_reloaded.fields.TEXT`</dt><dd><p>This type is for body text. It indexes (and optionally stores) the text and
stores term positions to allow phrase searching.</p>
<p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields use <code class="xref py py-class docutils literal notranslate"><span class="pre">StandardAnalyzer</span></code> by default. To specify a different
analyzer, use the <code class="docutils literal notranslate"><span class="pre">analyzer</span></code> keyword argument to the constructor, e.g.
<code class="docutils literal notranslate"><span class="pre">TEXT(analyzer=analysis.StemmingAnalyzer())</span></code>. See <a class="reference internal" href="analysis.html"><span class="doc">About analyzers</span></a>.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields store position information for each indexed term, to
allow you to search for phrases. If you don’t need to be able to search for
phrases in a text field, you can turn off storing term positions to save
space. Use <code class="docutils literal notranslate"><span class="pre">TEXT(phrase=False)</span></code>.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> fields are not stored. Usually you will not want to store
the body text in the search index. Usually you have the indexed documents
themselves available to read or link to based on the search results, so you
don’t need to store their text in the search index. However, in some
circumstances it can be useful (see <a class="reference internal" href="highlight.html"><span class="doc">How to create highlighted search result excerpts</span></a>). Use
<code class="docutils literal notranslate"><span class="pre">TEXT(stored=True)</span></code> to specify that the text should be stored in the index.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.KEYWORD`</dt><dd><p>This field type is designed for space- or comma-separated keywords. This
type is indexed and searchable (and optionally stored). To save space, it
does not support phrase searching.</p>
<p>To store the value of the field in the index, use <code class="docutils literal notranslate"><span class="pre">stored=True</span></code> in the
constructor. To automatically lowercase the keywords before indexing them,
use <code class="docutils literal notranslate"><span class="pre">lowercase=True</span></code>.</p>
<p>By default, the keywords are space separated. To separate the keywords by
commas instead (to allow keywords containing spaces), use <code class="docutils literal notranslate"><span class="pre">commas=True</span></code>.</p>
<p>If your users will use the keyword field for searching, use <code class="docutils literal notranslate"><span class="pre">scorable=True</span></code>.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.ID`</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">ID</span></code> field type simply indexes (and optionally stores) the entire value of
the field as a single unit (that is, it doesn’t break it up into individual
terms). This type of field does not store frequency information, so it’s
quite compact, but not very useful for scoring.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">ID</span></code> for fields like url or path (the URL or file path of a document),
date, category – fields where the value must be treated as a whole, and
each document only has one value for the field.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">ID</span></code> fields are not stored. Use <code class="docutils literal notranslate"><span class="pre">ID(stored=True)</span></code> to specify that
the value of the field should be stored with the document for use in the
search results. For example, you would want to store the value of a url
field so you could provide links to the original in your search results.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.STORED`</dt><dd><p>This field is stored with the document, but not indexed and not searchable.
This is useful for document information you want to display to the user in
the search results, but don’t need to be able to search for.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.NUMERIC`</dt><dd><p>This field stores int, long, or floating point numbers in a compact,
sortable format.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.DATETIME`</dt><dd><p>This field stores datetime objects in a compact, sortable format.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.BOOLEAN`</dt><dd><p>This simple filed indexes boolean values and allows users to search for
<code class="docutils literal notranslate"><span class="pre">yes</span></code>, <code class="docutils literal notranslate"><span class="pre">no</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">t</span></code> or <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
</dd>
<dt>:class:` whoosh_reloaded.fields.NGRAM`</dt><dd><p>TBD.</p>
</dd>
</dl>
<p>Expert users can create their own field types.</p>
</section>
<section id="creating-a-schema">
<h2>Creating a Schema<a class="headerlink" href="#creating-a-schema" title="Permalink to this heading">¶</a></h2>
<p>To create a schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">whoosh_reloaded.fields</span> <span class="kn">import</span> <span class="n">Schema</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">KEYWORD</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">STORED</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded.analysis</span> <span class="kn">import</span> <span class="n">StemmingAnalyzer</span>

<span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span><span class="n">from_addr</span><span class="o">=</span><span class="n">ID</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">to_addr</span><span class="o">=</span><span class="n">ID</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">subject</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">body</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="n">StemmingAnalyzer</span><span class="p">()),</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">KEYWORD</span><span class="p">)</span>
</pre></div>
</div>
<p>If you aren’t specifying any constructor keyword arguments to one of the
predefined fields, you can leave off the brackets (e.g. <code class="docutils literal notranslate"><span class="pre">fieldname=TEXT</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">fieldname=TEXT()</span></code>). Whoosh will instantiate the class for you.</p>
<p>Alternatively you can create a schema declaratively using the <code class="docutils literal notranslate"><span class="pre">SchemaClass</span></code>
base class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">whoosh_reloaded.fields</span> <span class="kn">import</span> <span class="n">SchemaClass</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">KEYWORD</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">STORED</span>

<span class="k">class</span> <span class="nc">MySchema</span><span class="p">(</span><span class="n">SchemaClass</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">TEXT</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TEXT</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">KEYWORD</span>
</pre></div>
</div>
<p>You can pass a declarative class to <code class="xref py py-func docutils literal notranslate"><span class="pre">create_in()</span></code> or
<code class="xref py py-meth docutils literal notranslate"><span class="pre">create_index()</span></code> instead of a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code> instance.</p>
</section>
<section id="modifying-the-schema-after-indexing">
<h2>Modifying the schema after indexing<a class="headerlink" href="#modifying-the-schema-after-indexing" title="Permalink to this heading">¶</a></h2>
<p>After you have created an index, you can add or remove fields to the schema
using the <code class="docutils literal notranslate"><span class="pre">add_field()</span></code> and <code class="docutils literal notranslate"><span class="pre">remove_field()</span></code> methods. These methods are
on the <code class="docutils literal notranslate"><span class="pre">Writer</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;fieldname&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">writer</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>(If you’re going to modify the schema <em>and</em> add documents using the same
writer, you must call <code class="docutils literal notranslate"><span class="pre">add_field()</span></code> and/or <code class="docutils literal notranslate"><span class="pre">remove_field</span></code> <em>before</em> you
add any documents.)</p>
<p>These methods are also on the <code class="docutils literal notranslate"><span class="pre">Index</span></code> object as a convenience, but when you
call them on an <code class="docutils literal notranslate"><span class="pre">Index</span></code>, the Index object simply creates the writer, calls
the corresponding method on it, and commits, so if you want to add or remove
more than one field, it’s much more efficient to create the writer yourself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ix</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;fieldname&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">KEYWORD</span><span class="p">)</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">filedb</span></code> backend, removing a field simply removes that field from the
<em>schema</em> – the index will not get smaller, data about that field will remain
in the index until you optimize. Optimizing will compact the index, removing
references to the deleted field as it goes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">ID</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">writer</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Because data is stored on disk with the field name, <em>do not</em> add a new field with
the same name as a deleted field without optimizing the index in between:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">delete_field</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
<span class="c1"># Don&#39;t do this!!!</span>
<span class="n">writer</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">KEYWORD</span><span class="p">)</span>
</pre></div>
</div>
<p>(A future version of Whoosh may automatically prevent this error.)</p>
</section>
<section id="dynamic-fields">
<h2>Dynamic fields<a class="headerlink" href="#dynamic-fields" title="Permalink to this heading">¶</a></h2>
<p>Dynamic fields let you associate a field type with any field name that matches
a given “glob” (a name pattern containing <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code>, and/or <code class="docutils literal notranslate"><span class="pre">[abc]</span></code>
wildcards).</p>
<p>You can add dynamic fields to a new schema using the <code class="docutils literal notranslate"><span class="pre">add()</span></code> method with the
<code class="docutils literal notranslate"><span class="pre">glob</span></code> keyword set to True:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c1"># Any name ending in &quot;_d&quot; will be treated as a stored</span>
<span class="c1"># DATETIME field</span>
<span class="n">schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;*_d&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">glob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To set up a dynamic field on an existing index, use the same
<code class="docutils literal notranslate"><span class="pre">IndexWriter.add_field</span></code> method as if you were adding a regular field, but
with the <code class="docutils literal notranslate"><span class="pre">glob</span></code> keyword argument set to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;*_d&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">glob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>To remove a dynamic field, use the <code class="docutils literal notranslate"><span class="pre">IndexWriter.remove_field()</span></code> method with
the glob as the name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">writer</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="s2">&quot;*_d&quot;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>For example, to allow documents to contain any field name that ends in <code class="docutils literal notranslate"><span class="pre">_id</span></code>
and associate it with the <code class="docutils literal notranslate"><span class="pre">ID</span></code> field type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
<span class="n">schema</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;*_id&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ix</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">create_in</span><span class="p">(</span><span class="s2">&quot;myindex&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">writer</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;/a&quot;</span><span class="p">,</span> <span class="n">test_id</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;alfa&quot;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">add_document</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;/b&quot;</span><span class="p">,</span> <span class="n">class_id</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;MyClass&quot;</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="n">w</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="n">qp</span> <span class="o">=</span> <span class="n">qparser</span><span class="o">.</span><span class="n">QueryParser</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;test_id:alfa&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">ix</span><span class="o">.</span><span class="n">searcher</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="advanced-schema-setup">
<h2>Advanced schema setup<a class="headerlink" href="#advanced-schema-setup" title="Permalink to this heading">¶</a></h2>
<section id="field-boosts">
<h3>Field boosts<a class="headerlink" href="#field-boosts" title="Permalink to this heading">¶</a></h3>
<p>You can specify a field boost for a field. This is a multiplier applied to the
score of any term found in the field. For example, to make terms found in the
title field score twice as high as terms in the body field:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">field_boost</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span> <span class="n">body</span><span class="o">=</span><span class="n">TEXT</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="field-types">
<h3>Field types<a class="headerlink" href="#field-types" title="Permalink to this heading">¶</a></h3>
<p>The predefined field types listed above are subclasses of <code class="docutils literal notranslate"><span class="pre">fields.FieldType</span></code>.
<code class="docutils literal notranslate"><span class="pre">FieldType</span></code> is a pretty simple class. Its attributes contain information that
define the behavior of a field.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>format</p></td>
<td><p>fields.Format</p></td>
<td><p>Defines what kind of information a field records
about each term, and how the information is stored
on disk.</p></td>
</tr>
<tr class="row-odd"><td><p>vector</p></td>
<td><p>fields.Format</p></td>
<td><p>Optional: if defined, the format in which to store
per-document forward-index information for this field.</p></td>
</tr>
<tr class="row-even"><td><p>scorable</p></td>
<td><p>bool</p></td>
<td><p>If True, the length of (number of terms in) the field in
each document is stored in the index. Slightly misnamed,
since field lengths are not required for all scoring.
However, field lengths are required to get proper
results from BM25F.</p></td>
</tr>
<tr class="row-odd"><td><p>stored</p></td>
<td><p>bool</p></td>
<td><p>If True, the value of this field is stored
in the index.</p></td>
</tr>
<tr class="row-even"><td><p>unique</p></td>
<td><p>bool</p></td>
<td><p>If True, the value of this field may be used to
replace documents with the same value when the user
calls
<code class="xref py py-meth docutils literal notranslate"><span class="pre">document_update()</span></code>
on an <code class="docutils literal notranslate"><span class="pre">IndexWriter</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>The constructors for most of the predefined field types have parameters that let
you customize these parts. For example:</p>
<ul class="simple">
<li><p>Most of the predefined field types take a stored keyword argument that sets
FieldType.stored.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">TEXT()</span></code> constructor takes an <code class="docutils literal notranslate"><span class="pre">analyzer</span></code> keyword argument that is
passed on to the format object.</p></li>
</ul>
</section>
<section id="formats">
<h3>Formats<a class="headerlink" href="#formats" title="Permalink to this heading">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Format</span></code> object defines what kind of information a field records about each
term, and how the information is stored on disk.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">Existence</span></code> format would store postings like this:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Doc</p></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>10</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Whereas the <code class="docutils literal notranslate"><span class="pre">Positions</span></code> format would store postings like this:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Doc</p></th>
<th class="head"><p>Positions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>10</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[1,5,23]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[45]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[7,12]</span></code></p></td>
</tr>
</tbody>
</table>
<p>The indexing code passes the unicode string for a field to the field’s <code class="docutils literal notranslate"><span class="pre">Format</span></code>
object. The <code class="docutils literal notranslate"><span class="pre">Format</span></code> object calls its analyzer (see text analysis) to break the
string into tokens, then encodes information about each token.</p>
<p>Whoosh ships with the following pre-defined formats.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Class name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Stored</p></td>
<td><p>A “null” format for fields that are stored but not indexed.</p></td>
</tr>
<tr class="row-odd"><td><p>Existence</p></td>
<td><p>Records only whether a term is in a document or not, i.e. it
does not store term frequency. Useful for identifier fields
(e.g. path or id) and “tag”-type fields, where the frequency
is expected to always be 0 or 1.</p></td>
</tr>
<tr class="row-even"><td><p>Frequency</p></td>
<td><p>Stores the number of times each term appears in each document.</p></td>
</tr>
<tr class="row-odd"><td><p>Positions</p></td>
<td><p>Stores the number of times each term appears in each document,
and at what positions.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">STORED</span></code> field type uses the <code class="docutils literal notranslate"><span class="pre">Stored</span></code> format (which does nothing, so <code class="docutils literal notranslate"><span class="pre">STORED</span></code>
fields are not indexed). The <code class="docutils literal notranslate"><span class="pre">ID</span></code> type uses the <code class="docutils literal notranslate"><span class="pre">Existence</span></code> format. The <code class="docutils literal notranslate"><span class="pre">KEYWORD</span></code> type
uses the <code class="docutils literal notranslate"><span class="pre">Frequency</span></code> format. The <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> type uses the <code class="docutils literal notranslate"><span class="pre">Positions</span></code> format if it is
instantiated with <code class="docutils literal notranslate"><span class="pre">phrase=True</span></code> (the default), or <code class="docutils literal notranslate"><span class="pre">Frequency</span></code> if <code class="docutils literal notranslate"><span class="pre">phrase=False</span></code>.</p>
<p>In addition, the following formats are implemented for the possible convenience
of expert users, but are not currently used in Whoosh:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Class name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DocBoosts</p></td>
<td><p>Like Existence, but also stores per-document boosts</p></td>
</tr>
<tr class="row-odd"><td><p>Characters</p></td>
<td><p>Like Positions, but also stores the start and end character
indices of each term</p></td>
</tr>
<tr class="row-even"><td><p>PositionBoosts</p></td>
<td><p>Like Positions, but also stores per-position boosts</p></td>
</tr>
<tr class="row-odd"><td><p>CharacterBoosts</p></td>
<td><p>Like Positions, but also stores the start and end character
indices of each term and per-position boosts</p></td>
</tr>
</tbody>
</table>
</section>
<section id="vectors">
<h3>Vectors<a class="headerlink" href="#vectors" title="Permalink to this heading">¶</a></h3>
<p>The main index is an inverted index. It maps terms to the documents they appear
in. It is also sometimes useful to store a forward index, also known as a term
vector, that maps documents to the terms that appear in them.</p>
<p>For example, imagine an inverted index like this for a field:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>Postings</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>apple</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[(doc=1,</span> <span class="pre">freq=2),</span> <span class="pre">(doc=2,</span> <span class="pre">freq=5),</span> <span class="pre">(doc=3,</span> <span class="pre">freq=1)]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>bear</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[(doc=2,</span> <span class="pre">freq=7)]</span></code></p></td>
</tr>
</tbody>
</table>
<p>The corresponding forward index, or term vector, would be:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Doc</p></th>
<th class="head"><p>Postings</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[(text=apple,</span> <span class="pre">freq=2)]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[(text=apple,</span> <span class="pre">freq=5),</span> <span class="pre">(text='bear',</span> <span class="pre">freq=7)]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[(text=apple,</span> <span class="pre">freq=1)]</span></code></p></td>
</tr>
</tbody>
</table>
<p>If you set <code class="docutils literal notranslate"><span class="pre">FieldType.vector</span></code> to a <code class="docutils literal notranslate"><span class="pre">Format</span></code> object, the indexing code will use the
<code class="docutils literal notranslate"><span class="pre">Format</span></code> object to store information about the terms in each document. Currently
by default Whoosh does not make use of term vectors at all, but they are
available to expert users who want to implement their own field types.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="glossary.html" class="btn btn-neutral float-left" title="Glossary" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="indexing.html" class="btn btn-neutral float-right" title="How to index documents" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2007-2012 Matt Chaput.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>