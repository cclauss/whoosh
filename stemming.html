<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stemming, variations, and accent folding &mdash; Whoosh-Reloaded 2.7.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Indexing and searching N-grams" href="ngrams.html" />
    <link rel="prev" title="About analyzers" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Whoosh-Reloaded
          </a>
              <div class="version">
                2.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to Whoosh</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema.html">Designing a schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">How to index documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="searching.html">How to search</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsing.html">Parsing user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="querylang.html">The default query language</a></li>
<li class="toctree-l1"><a class="reference internal" href="dates.html">Indexing and parsing dates/times</a></li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Query objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">About analyzers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stemming, variations, and accent folding</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-problem">The problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stemming">Stemming</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variations">Variations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lemmatization">Lemmatization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#character-folding">Character folding</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ngrams.html">Indexing and searching N-grams</a></li>
<li class="toctree-l1"><a class="reference internal" href="facets.html">Sorting and faceting</a></li>
<li class="toctree-l1"><a class="reference internal" href="highlight.html">How to create highlighted search result excerpts</a></li>
<li class="toctree-l1"><a class="reference internal" href="keywords.html">Query expansion and Key word extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="spelling.html">“Did you mean… ?” Correcting errors in user queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="fieldcaches.html">Field caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Tips for speeding up batch indexing</a></li>
<li class="toctree-l1"><a class="reference internal" href="threads.html">Concurrency, locking, and versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested.html">Indexing and searching document hierarchies</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Whoosh recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">Whoosh API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech/index.html">Technical notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Whoosh-Reloaded</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Stemming, variations, and accent folding</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/stemming.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="stemming-variations-and-accent-folding">
<h1>Stemming, variations, and accent folding<a class="headerlink" href="#stemming-variations-and-accent-folding" title="Permalink to this heading">¶</a></h1>
<section id="the-problem">
<h2>The problem<a class="headerlink" href="#the-problem" title="Permalink to this heading">¶</a></h2>
<p>The indexed text will often contain words in different form than the one
the user searches for. For example, if the user searches for <code class="docutils literal notranslate"><span class="pre">render</span></code>, we
would like the search to match not only documents that contain the <code class="docutils literal notranslate"><span class="pre">render</span></code>,
but also <code class="docutils literal notranslate"><span class="pre">renders</span></code>, <code class="docutils literal notranslate"><span class="pre">rendering</span></code>, <code class="docutils literal notranslate"><span class="pre">rendered</span></code>, etc.</p>
<p>A related problem is one of accents. Names and loan words may contain accents in
the original text but not in the user’s query, or vice versa. For example, we
want the user to be able to search for <code class="docutils literal notranslate"><span class="pre">cafe</span></code> and find documents containing
<code class="docutils literal notranslate"><span class="pre">café</span></code>.</p>
<p>The default analyzer for the :class:` whoosh_reloaded.fields.TEXT` field does not do
stemming or accent folding.</p>
</section>
<section id="stemming">
<h2>Stemming<a class="headerlink" href="#stemming" title="Permalink to this heading">¶</a></h2>
<p>Stemming is a heuristic process of removing suffixes (and sometimes prefixes)
from words to arrive (hopefully, most of the time) at the base word. Whoosh
includes several stemming algorithms such as Porter and Porter2, Paice Husk,
and Lovins.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">whoosh_reloaded.lang.porter</span> <span class="kn">import</span> <span class="n">stem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stem</span><span class="p">(</span><span class="s2">&quot;rendering&quot;</span><span class="p">)</span>
<span class="go">&#39;render&#39;</span>
</pre></div>
</div>
<p>The stemming filter applies the stemming function to the terms it indexes, and
to words in user queries. So in theory all variations of a root word (“render”,
“rendered”, “renders”, “rendering”, etc.) are reduced to a single term in the
index, saving space. And all possible variations users might use in a query
are reduced to the root, so stemming enhances “recall”.</p>
<p>The :class:` whoosh_reloaded.analysis.StemFilter` lets you add a stemming filter to an
analyzer chain.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rext</span> <span class="o">=</span> <span class="n">RegexTokenizer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">rext</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;fundamentally willows&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stemmer</span> <span class="o">=</span> <span class="n">StemFilter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">stemmer</span><span class="p">(</span><span class="n">stream</span><span class="p">)]</span>
<span class="go">[u&quot;fundament&quot;, u&quot;willow&quot;]</span>
</pre></div>
</div>
<p>The :func:` whoosh_reloaded.analysis.StemmingAnalyzer` is a pre-packaged analyzer that
combines a tokenizer, lower-case filter, optional stop filter, and stem filter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">whoosh_reloaded</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded.analysis</span> <span class="kn">import</span> <span class="n">StemmingAnalyzer</span>

<span class="n">stem_ana</span> <span class="o">=</span> <span class="n">StemmingAnalyzer</span><span class="p">()</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="n">stem_ana</span><span class="p">,</span> <span class="n">stored</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                       <span class="n">content</span><span class="o">=</span><span class="n">TEXT</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="n">stem_ana</span><span class="p">))</span>
</pre></div>
</div>
<p>Stemming has pros and cons.</p>
<ul class="simple">
<li><p>It allows the user to find documents without worrying about word forms.</p></li>
<li><p>It reduces the size of the index, since it reduces the number of separate
terms indexed by “collapsing” multiple word forms into a single base word.</p></li>
<li><p>It’s faster than using variations (see below)</p></li>
<li><p>The stemming algorithm can sometimes incorrectly conflate words or change
the meaning of a word by removing suffixes.</p></li>
<li><p>The stemmed forms are often not proper words, so the terms in the field
are not useful for things like creating a spelling dictionary.</p></li>
</ul>
</section>
<section id="variations">
<h2>Variations<a class="headerlink" href="#variations" title="Permalink to this heading">¶</a></h2>
<p>Whereas stemming encodes the words in the index in a base form, when you use
variations you instead index words “as is” and <em>at query time</em> expand words
in the user query using a heuristic algorithm to generate morphological
variations of the word.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">whoosh_reloaded.lang.morph_en</span> <span class="kn">import</span> <span class="n">variations</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variations</span><span class="p">(</span><span class="s2">&quot;rendered&quot;</span><span class="p">)</span>
<span class="go">set([&#39;rendered&#39;, &#39;rendernesses&#39;, &#39;render&#39;, &#39;renderless&#39;, &#39;rendering&#39;,</span>
<span class="go">&#39;renderness&#39;, &#39;renderes&#39;, &#39;renderer&#39;, &#39;renderements&#39;, &#39;rendereless&#39;,</span>
<span class="go">&#39;renderenesses&#39;, &#39;rendere&#39;, &#39;renderment&#39;, &#39;renderest&#39;, &#39;renderement&#39;,</span>
<span class="go">&#39;rendereful&#39;, &#39;renderers&#39;, &#39;renderful&#39;, &#39;renderings&#39;, &#39;renders&#39;, &#39;renderly&#39;,</span>
<span class="go">&#39;renderely&#39;, &#39;rendereness&#39;, &#39;renderments&#39;])</span>
</pre></div>
</div>
<p>Many of the generated variations for a given word will not be valid words, but
it’s fairly fast for Whoosh to check which variations are actually in the
index and only search for those.</p>
<p>The :class:` whoosh_reloaded.query.Variations` query object lets you search for variations
of a word. Whereas the normal :class:` whoosh_reloaded.query.Term` object only searches
for the given term, the <code class="docutils literal notranslate"><span class="pre">Variations</span></code> query acts like an <code class="docutils literal notranslate"><span class="pre">Or</span></code> query for the
variations of the given word in the index. For example, the query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="n">Variations</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;rendered&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>…might act like this (depending on what words are in the index):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="o">.</span><span class="n">Or</span><span class="p">([</span><span class="n">query</span><span class="o">.</span><span class="n">Term</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;render&quot;</span><span class="p">),</span> <span class="n">query</span><span class="o">.</span><span class="n">Term</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;rendered&quot;</span><span class="p">),</span>
          <span class="n">query</span><span class="o">.</span><span class="n">Term</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;renders&quot;</span><span class="p">),</span> <span class="n">query</span><span class="o">.</span><span class="n">Term</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;rendering&quot;</span><span class="p">)])</span>
</pre></div>
</div>
<p>To have the query parser use :class:` whoosh_reloaded.query.Variations` instead of
:class:` whoosh_reloaded.query.Term` for individual terms, use the <code class="docutils literal notranslate"><span class="pre">termclass</span></code>
keyword argument to the parser initialization method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">whoosh_reloaded</span> <span class="kn">import</span> <span class="n">qparser</span><span class="p">,</span> <span class="n">query</span>

<span class="n">qp</span> <span class="o">=</span> <span class="n">qparser</span><span class="o">.</span><span class="n">QueryParser</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="n">termclass</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">Variations</span><span class="p">)</span>
</pre></div>
</div>
<p>Variations has pros and cons.</p>
<ul class="simple">
<li><p>It allows the user to find documents without worrying about word forms.</p></li>
<li><p>The terms in the field are actual words, not stems, so you can use the
field’s contents for other purposes such as spell checking queries.</p></li>
<li><p>It increases the size of the index relative to stemming, because different
word forms are indexed separately.</p></li>
<li><p>It acts like an <code class="docutils literal notranslate"><span class="pre">Or</span></code> search for all the variations, which is slower than
searching for a single term.</p></li>
</ul>
</section>
<section id="lemmatization">
<h2>Lemmatization<a class="headerlink" href="#lemmatization" title="Permalink to this heading">¶</a></h2>
<p>Whereas stemming is a somewhat “brute force”, mechanical attempt at reducing
words to their base form using simple rules, lemmatization usually refers to
more sophisticated methods of finding the base form (“lemma”) of a word using
language models, often involving analysis of the surrounding context and
part-of-speech tagging.</p>
<p>Whoosh does not include any lemmatization functions, but if you have separate
lemmatizing code you could write a custom :class:` whoosh_reloaded.analysis.Filter`
to integrate it into a Whoosh analyzer.</p>
</section>
<section id="character-folding">
<h2>Character folding<a class="headerlink" href="#character-folding" title="Permalink to this heading">¶</a></h2>
<p>You can set up an analyzer to treat, for example, <code class="docutils literal notranslate"><span class="pre">á</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">å</span></code>, and <code class="docutils literal notranslate"><span class="pre">â</span></code>
as equivalent to improve recall. This is often very useful, allowing the user
to, for example, type <code class="docutils literal notranslate"><span class="pre">cafe</span></code> or <code class="docutils literal notranslate"><span class="pre">resume</span></code> and find documents containing
<code class="docutils literal notranslate"><span class="pre">café</span></code> and <code class="docutils literal notranslate"><span class="pre">resumé</span></code>.</p>
<p>Character folding is especially useful for unicode characters that may appear
in Asian language texts that should be treated as equivalent to their ASCII
equivalent, such as “half-width” characters.</p>
<p>Character folding is not always a panacea. See this article for caveats on where
accent folding can break down.</p>
<p><a class="reference external" href="http://www.alistapart.com/articles/accent-folding-for-auto-complete/">http://www.alistapart.com/articles/accent-folding-for-auto-complete/</a></p>
<p>Whoosh includes several mechanisms for adding character folding to an analyzer.</p>
<p>The :class:` whoosh_reloaded.analysis.CharsetFilter` applies a character map to token
text. For example, it will filter the tokens <code class="docutils literal notranslate"><span class="pre">u'café',</span> <span class="pre">u'resumé',</span> <span class="pre">...</span></code> to
<code class="docutils literal notranslate"><span class="pre">u'cafe',</span> <span class="pre">u'resume',</span> <span class="pre">...</span></code>. This is usually the method you’ll want to use
unless you need to use a charset to tokenize terms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">whoosh_reloaded.analysis</span> <span class="kn">import</span> <span class="n">CharsetFilter</span><span class="p">,</span> <span class="n">StemmingAnalyzer</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded.support.charset</span> <span class="kn">import</span> <span class="n">accent_map</span>

<span class="c1"># For example, to add an accent-folding filter to a stemming analyzer:</span>
<span class="n">my_analyzer</span> <span class="o">=</span> <span class="n">StemmingAnalyzer</span><span class="p">()</span> <span class="o">|</span> <span class="n">CharsetFilter</span><span class="p">(</span><span class="n">accent_map</span><span class="p">)</span>

<span class="c1"># To use this analyzer in your schema:</span>
<span class="n">my_schema</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">TEXT</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="n">my_analyzer</span><span class="p">))</span>
</pre></div>
</div>
<p>The :class:` whoosh_reloaded.analysis.CharsetTokenizer` uses a Sphinx charset table to
both separate terms and perform character folding. This tokenizer is slower
than the :class:` whoosh_reloaded.analysis.RegexTokenizer` because it loops over each
character in Python. If the language(s) you’re indexing can be tokenized using
regular expressions, it will be much faster to use <code class="docutils literal notranslate"><span class="pre">RegexTokenizer</span></code> and
<code class="docutils literal notranslate"><span class="pre">CharsetFilter</span></code> in combination instead of using <code class="docutils literal notranslate"><span class="pre">CharsetTokenizer</span></code>.</p>
<p>The :mod:` whoosh_reloaded.support.charset` module contains an accent folding map useful
for most Western languages, as well as a much more extensive Sphinx charset
table and a function to convert Sphinx charset tables into the character maps
required by <code class="docutils literal notranslate"><span class="pre">CharsetTokenizer</span></code> and <code class="docutils literal notranslate"><span class="pre">CharsetFilter</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># To create a filter using an enourmous character map for most languages</span>
<span class="c1"># generated from a Sphinx charset table</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded.analysis</span> <span class="kn">import</span> <span class="n">CharsetFilter</span>
<span class="kn">from</span> <span class="nn">whoosh_reloaded.support.charset</span> <span class="kn">import</span> <span class="n">default_charset</span><span class="p">,</span> <span class="n">charset_table_to_dict</span>
<span class="n">charmap</span> <span class="o">=</span> <span class="n">charset_table_to_dict</span><span class="p">(</span><span class="n">default_charset</span><span class="p">)</span>
<span class="n">my_analyzer</span> <span class="o">=</span> <span class="n">StemmingAnalyzer</span><span class="p">()</span> <span class="o">|</span> <span class="n">CharsetFilter</span><span class="p">(</span><span class="n">charmap</span><span class="p">)</span>
</pre></div>
</div>
<p>(The Sphinx charset table format is described at
<a class="reference external" href="http://www.sphinxsearch.com/docs/current.html#conf-charset-table">http://www.sphinxsearch.com/docs/current.html#conf-charset-table</a> )</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analysis.html" class="btn btn-neutral float-left" title="About analyzers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ngrams.html" class="btn btn-neutral float-right" title="Indexing and searching N-grams" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2007-2012 Matt Chaput.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>